<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <script>!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cloudbae",[],t):"object"==typeof exports?exports.cloudbae=t():e.cloudbae=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var r=function(){function e(){var e=this;this.alipayApi=window.my,this.listeners={},this.eventId=0,this.alipayApi.onMessage=function(t){var n=e.listeners[t.eventId];"call"===t.type&&(e.listeners[t.eventId]=null),n(t.data)}}return e.prototype.registerHandler=function(e,t){this.eventId++,this.listeners[this.eventId]=function(e){t(e.data,e.responseCallback)},this.alipayApi.postMessage({type:"register",methodName:e,eventId:this.eventId})},e.prototype.callHandler=function(e,t,n){this.eventId++,this.listeners[this.eventId]=n,this.alipayApi.postMessage({type:"call",eventId:this.eventId,methodName:e,handleName:t.handlerName,params:t.params})},e}(),i=(n(1),function(){return new Promise(function(e){var t=function(){e(window.WebViewJavascriptBridge)};if(window.WebViewJavascriptBridge)return e(window.WebViewJavascriptBridge);if(document.addEventListener("WebViewJavascriptBridgeReady",t,!1),window.WVJBCallbacks)return window.WVJBCallbacks.push(t);window.WVJBCallbacks=[t];var n=document.createElement("iframe");n.style.display="none",n.src="https://__bridge_loaded__",document.documentElement.appendChild(n),setTimeout(function(){document.documentElement.removeChild(n)})})}),a=function(){function e(e,t){var n=this;this.logger=e,this.handler=t,this.token="ybb.native.call",this.isAlipayApp=navigator.userAgent.indexOf("AlipayClient")>-1,this.isAlipayApp?this.bridgeWrapper=new Promise(function(e){var t=document.createElement("script"),n=document.querySelector("head");t.onload=function(){e(new r),n.removeChild(t)},t.onerror=function(){e(new r),n.removeChild(t)},t.src="https://appx/web-view.min.js",n.appendChild(t)}).then(function(e){return n.bridge=e,e}):this.bridgeWrapper=i().then(function(e){return n.bridge=e,e})}return e.prototype.registerHandler=function(e,t){var n=this,r=this;function i(n,i){r.logger("[register: "+e+"] data: "+JSON.stringify(n)),t(n,i)}this.logger("[register: "+e+"]"),this.bridge?this.bridge.registerHandler(e,i):this.bridgeWrapper.then(function(){n.bridge.registerHandler(e,i)})},e.prototype.callHandler=function(e,t){var n=this;return void 0===t&&(t={}),this.logger("[call: "+e+"] params: "+JSON.stringify(t)),new Promise(function(r,i){var a=function(a){a="string"==typeof a?JSON.parse(a):a,n.logger("[call: "+e+"] ("+JSON.stringify(t)+") => "+JSON.stringify(a)),"function"==typeof n.handler?n.handler(a,r,i):a.success?r(a.data):i(new Error(a.message))};n.bridge?n.bridge.callHandler(n.token,{handlerName:e,params:t},a):n.bridgeWrapper.then(function(){n.bridge.callHandler(n.token,{handlerName:e,params:t},a)})})},e.prototype.listen=function(e,t,n){var r=this;void 0===t&&(t={}),this.logger("[listen: "+e+"] params: "+t);var i=function(i){i="string"==typeof i?JSON.parse(i):i,r.logger("[listen: "+e+"] ("+JSON.stringify(t)+") => "+JSON.stringify(i)),i.success&&"function"==typeof n&&n(i.data)};this.bridge?this.bridge.callHandler(this.token,{handlerName:e,params:t||{}},i):this.bridgeWrapper.then(function(){r.bridge.callHandler(r.token,{handlerName:e,params:t||{}},i)})},e}();function o(e,t){function n(e){return e<9?"0"+e:""+e}return void 0===t&&(t=!1),function(r){for(var i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];if(t){var o=new Date,u=o.getFullYear()+"-"+n(o.getMonth()+1)+"-"+n(o.getDate())+" "+n(o.getHours())+":"+n(o.getMinutes())+":"+n(o.getSeconds()),c=i.map(function(e){return""+e}).join(" ");console.log("["+u+" "+e+"]: "+r+" "+c)}}}var u=new a(o("Guard",!0));function c(e,t){void 0===e&&(e=""),void 0===t&&(t="");for(var n=e.split(".").map(function(e){return+e}),r=t.split(".").map(function(e){return+e}),i=Math.max(r.length,n.length),a=0;a<i;a++){if(n[a]||0===n[a]){if(r[a]||0===r[a]){if(n[a]<r[a])return"<";if(n[a]>r[a])return">";continue}return">"}return r[a]||0===r[a]?"<":">"}return"="}function s(){return new Promise(function(e,t){var n=setTimeout(function(){t(new Error("暂不支持该方法"))},1e3);u.callHandler("device.getAppVersion").then(function(t){clearTimeout(n),e(t)}).catch(function(e){"method device.getAppVersion is not defined"===e.message?t(new Error("暂不支持该方法")):t(e)})})}var l=function(){function e(){}return e.GreaterThanOrEqualTo=function(e){return function(t,n,r){var i=r.value;"function"==typeof i&&(r.value=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return s().then(function(r){if("<"===c(r,e))throw new Error("当前版本过低");return i.apply(t,n)})})}},e.LessThanOrEqualTo=function(e){return function(t,n,r){var i=r.value;"function"==typeof i&&(r.value=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return s().then(function(r){if(">"===c(r,e))throw new Error("当前版本过低");return i.apply(t,n)})})}},e}(),d=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},p=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};function f(){var e=navigator.userAgent;return e.indexOf("cloudbae-app-agx")>-1?"1.3.0.0":e.indexOf("cloudbae-app-ayl")>-1?"1.1.1.0":"2.9.0.0"}var g=function(){function e(e){this.isDebug=e,this.apiRegister=new a(o("Device",e))}return e.prototype.getLocation=function(){return this.apiRegister.callHandler("device.getLocation")},e.prototype.chooseImage=function(e){return void 0===e&&(e={max:10,sourceType:["拍照","相册"]}),this.apiRegister.callHandler("device.chooseImage",e)},e.prototype.capture=function(){return this.apiRegister.callHandler("device.capture")},e.prototype.scan=function(e){return this.apiRegister.callHandler("device.scan",{type:e})},e.prototype.savePicture=function(e){return this.apiRegister.callHandler("device.savePicture",e)},e.prototype.getAppVersion=function(){return this.apiRegister.callHandler("device.getAppVersion")},e.prototype.openUrlInBrowser=function(e){var t=this;return s().then(function(){return t.apiRegister.callHandler("device.openUrlInBrowser",{url:e})}).catch(function(){var n=new a(o("OldHybridAPI",t.isDebug),function(e,t,n){"0"===e.errorCode?t(e.result):n(e.message)});return n.token="dd.native.call",n.callHandler("biz.util.openSchemeURI",{url:null,params:{failUrl:e,package:""}})})},d([l.GreaterThanOrEqualTo(f()),p("design:type",Function),p("design:paramtypes",[Object]),p("design:returntype",void 0)],e.prototype,"savePicture",null),d([l.GreaterThanOrEqualTo(f()),p("design:type",Function),p("design:paramtypes",[]),p("design:returntype",Promise)],e.prototype,"getAppVersion",null),e}(),h=function(){function e(e){this.apiRegister=new a(o("Util",e))}return e.prototype.share=function(e){return this.apiRegister.callHandler("util.share",e)},e.prototype.dataCollection=function(e){return this.apiRegister.callHandler("util.dataCollection",e)},e.prototype.subscribeArea=function(e){return this.apiRegister.listen("util.area.get",null,e)},e}(),v=function(){function e(e){this.util=new h(e),this.apiRegister=new a(o("Pay",e))}return e.prototype.pay=function(e){return this.apiRegister.callHandler("pay.pay",e)},e}(),y=function(){function e(e){this.apiRegister=new a(o("User",e))}return e.prototype.authorization=function(e){return this.apiRegister.callHandler("user.authorization",{clientId:e})},e.prototype.realNameValidate=function(e){return void 0===e&&(e=!1),this.apiRegister.callHandler("user.realname.related",{againCheck:e})},e}();n.d(t,"HybridBridge",function(){return m}),n.d(t,"hybridBridge",function(){return b}),n.d(t,"version",function(){return w}),n.d(t,"Core",function(){return a}),n.d(t,"Device",function(){return g}),n.d(t,"User",function(){return y}),n.d(t,"Util",function(){return h});var m=function(){function e(e){void 0===e&&(e=!1),this._debug=!1,this.debug=e}return Object.defineProperty(e.prototype,"apiRegister",{get:function(){return new a(o("Custom",this.debug))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,this.device=new g(e),this.pay=new v(e),this.user=new y(e),this.util=new h(e)},enumerable:!0,configurable:!0}),e}(),b=new m,w="1.0.3"},function(e,t){!function(){var e=navigator.userAgent;if(!(e.indexOf("AlipayClient")>-1)){e.indexOf("Android")>-1||e.indexOf("Adr");if(!!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&!window.WebViewJavascriptBridge){var t,n=[],r=[],i={},a="ybb",o="__QUEUE_MESSAGE__/",u={},c=1,s=window.WebViewJavascriptBridge={init:function(e){if(s._messageHandler)throw new Error("WebViewJavascriptBridge.init called twice");s._messageHandler=e;var t=r;r=null;for(var n=0;n<t.length;n++)f(t[n])},send:function(e,t){p({data:e},t)},registerHandler:function(e,t){i[e]=t},callHandler:function(e,t,n){p({handlerName:e,data:t},n)},_fetchQueue:function(){var e=JSON.stringify(n);n=[],t.src=a+"://return/_fetchQueue/"+encodeURIComponent(e)},_handleMessageFromNative:function(e){console.log(e),r&&r.length>0?r.push(e):f(e)}},l=document;!function(e){(t=e.createElement("iframe")).style.display="none",e.documentElement.appendChild(t)}(l);var d=l.createEvent("Events");d.initEvent("WebViewJavascriptBridgeReady"),d.bridge=s,l.dispatchEvent(d)}}function p(e,r){if(r){var i="cb_"+c+++"_"+(new Date).getTime();u[i]=r,e.callbackId=i}n.push(e),t.src=a+"://"+o}function f(e){setTimeout(function(){var t,n=JSON.parse(e);if(n.responseId){if(!(t=u[n.responseId]))return;t(n.responseData)}else{if(n.callbackId){var r=n.callbackId;t=function(e){p({responseId:r,responseData:e})}}var a=s._messageHandler;n.handlerName&&(a=i[n.handlerName]);try{a(n.data,t)}catch(e){"undefined"!=typeof console&&console.log("WebViewJavascriptBridge: WARNING: javascript handler threw.",n,e)}}})}}()}])});</script>
  <script src="https://nnapp.cloudbae.cn:38080/storage/api/v1/file/hybrid/hybrid-api-3.5.3.js" type="text/javascript"></script>
</head>
<body>
<textarea type="text" id="imageContact" style="width:100%; height:200px;"></textarea>
<br>
<button type="button" id="btn">保存图片</button>
<br>
<h3>开始时间</h3>
<input type="text" name="beginDate" id="beginDate" value="2020-02-25">
<h3>结束时间</h3>
<input type="text" name="endDate" id="endDate" value="2020-02-25">
<br>
<br>
<button type="button" id="getHealthData">获取健康数据</button>
<br>
<h3>URL地址</h3>
<input type="text" name="urlPath" id="urlPath" value="https://www.baidu.com">
<br>
<button type="button" id="openURL">在外部浏览器打开</button>
<br>
<h3>iOS Universal Link</h3>
<br>
<a href="https://ul.cloudbae.cn/ann" target="_blank" rel="nofollow">爱南宁</a>
<br>
<a href="https://ul.cloudbae.cn/ayl" target="_blank" rel="nofollow">爱玉林</a>
<br>
<a href="https://ul.cloudbae.cn/agx" target="_blank" rel="nofollow">爱广西</a>
<br>
<h3>Deep Link</h3>
<br>
<a href="https://ul.cloudbae.cn/android_ann" target="_blank" rel="nofollow">爱南宁Android</a>
<br>
<br>
<h3>这是用window.open()修改location无效的案例</h3>
<button type="button" id="openURLLinkFail">打开URL</button>
<br>
<br>
<h3>这是用window.open()修改location有效的案例</h3>
<button type="button" id="openURLLinkSuccess">打开URL</button>
<br>
  
<script>
  var btn = document.getElementById('btn');
  btn.onclick = function () {
    var data = document.getElementById('imageContact')
    var encode = data.value.indexOf('http') == 0 ? 'url' : 'base64'
    cloudbae.hybridBridge.device.savePicture({
      data: data.value,
      encode: encode
    }).then(function () {
      var msg = '保存成功'
      console.log(msg)
      alert(msg)
    }).catch(function (e) {
      console.log(e.message)
      var msg = (e.message.length == 0 || e.message == null) ? '抛出异常，异常消息为空' : e.message
      alert(msg)
    })
  }

  var btnGetHealthData = document.getElementById('getHealthData');
  btnGetHealthData.onclick = function () {
    // alert('1234')
    var beginDate = document.getElementById('beginDate')
    var endDate = document.getElementById('endDate')
    YBB.hybrid.user.healthData({
      type: 'stepCount',
      startDate: beginDate.value, // 时间支持两种格式： yyy-MM-dd 或者 yyyy-MM-dd hh:mm:ss
      endDate: endDate.value
    }).then(function(result) {
      console.log(result.stepCount)
      var jsonData = JSON.stringify(result)
      alert(jsonData)
    }).catch(function (e) {
      console.log(e.message)
      var msg = (e.message.length == 0 || e.message == nil) ? '抛出异常，异常消息为空' : e.message
      alert(msg)
    })
  }
  
  var btnOpenURL = document.getElementById('openURL');
  btnOpenURL.onclick = function () {
    var data = document.getElementById('urlPath')
    // var url = null
    // var params = {'failUrl': data.value, 'package': ''}
    cloudbae.hybridBridge.device.openUrlInBrowser(data.value)
    .then(function(result) {
      console.log(result.stepCount)
      var jsonData = JSON.stringify(result)
      alert(jsonData)
    }).catch(function (e) {
      console.log(e.message)
      var msg = (e.message.length == 0 || e.message == null) ? '抛出异常，异常消息为空' : e.message
      alert(msg)
    })
  }
  
  var btnOpenURLLinkFail = document.getElementById('openURLLinkFail');
    btnOpenURLLinkFail.onclick = function () {
    var windowRef = window.open()
    windowRef.location = "http://www.cloudbae.cn/#" + random()
  }
  
  var btnOpenURLLinkSuccess = document.getElementById('openURLLinkSuccess');
    btnOpenURLLinkSuccess.onclick = function () {
      function newWin(url, id) {
          var a = document.createElement('a');
          a.setAttribute('href', url);
          a.setAttribute('target', '_blank');
          a.setAttribute('id', id);
          // 防止反复添加
          if(!document.getElementById(id)) document.body.appendChild(a);
          a.click();
      }
      newWin('http://www.cloudbae.cn', 'body')
    }
</script>
</body>
</html>
