<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <script>
    !function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("LocalYBB",[],t):"object"==typeof exports?exports.LocalYBB=t():e.LocalYBB=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var r=function(){function e(){var e=this;this.alipayApi=window.my,this.listeners={},this.eventId=0,this.alipayApi.onMessage=function(t){var n=e.listeners[t.eventId];"call"===t.type&&(e.listeners[t.eventId]=null),n(t.data)}}return e.prototype.registerHandler=function(e,t){this.eventId++,this.listeners[this.eventId]=function(e){t(e.data,e.responseCallback)},this.alipayApi.postMessage({type:"register",methodName:e,eventId:this.eventId})},e.prototype.callHandler=function(e,t,n){this.eventId++,this.listeners[this.eventId]=n,this.alipayApi.postMessage({type:"call",eventId:this.eventId,methodName:e,handleName:t.handlerName,params:t.params})},e}(),i=(n(1),function(){return new Promise(function(e){var t=function(){e(window.WebViewJavascriptBridge)};if(window.WebViewJavascriptBridge)return e(window.WebViewJavascriptBridge);if(document.addEventListener("WebViewJavascriptBridgeReady",t,!1),window.WVJBCallbacks)return window.WVJBCallbacks.push(t);window.WVJBCallbacks=[t];var n=document.createElement("iframe");n.style.display="none",n.src="https://__bridge_loaded__",document.documentElement.appendChild(n),setTimeout(function(){document.documentElement.removeChild(n)})})}),a=function(){function e(e){var t=this;this.logger=e,this.token="ybb.native.call",this.isAlipayApp=navigator.userAgent.indexOf("AlipayClient")>-1,this.isAlipayApp?this.bridgeWrapper=new Promise(function(e){var t=document.createElement("script"),n=document.querySelector("head");t.onload=function(){e(new r),n.removeChild(t)},t.onerror=function(){e(new r),n.removeChild(t)},t.src="https://appx/web-view.min.js",n.appendChild(t)}).then(function(e){return t.bridge=e,e}):this.bridgeWrapper=i().then(function(e){return t.bridge=e,e})}return e.prototype.registerHandler=function(e,t){var n=this,r=this;function i(n,i){r.logger("[register: "+e+"] data: "+JSON.stringify(n)),t(n,i)}this.logger("[register: "+e+"]"),this.bridge?this.bridge.registerHandler(e,i):this.bridgeWrapper.then(function(){n.bridge.registerHandler(e,i)})},e.prototype.callHandler=function(e,t){var n=this;return void 0===t&&(t={}),this.logger("[call: "+e+"] params: "+JSON.stringify(t)),new Promise(function(r,i){var a=function(a){a="string"==typeof a?JSON.parse(a):a,n.logger("[call: "+e+"] ("+JSON.stringify(t)+") => "+JSON.stringify(a)),a.success?r(a.data):i(new Error(a.message))};n.bridge?n.bridge.callHandler(n.token,{handlerName:e,params:t},a):n.bridgeWrapper.then(function(){n.bridge.callHandler(n.token,{handlerName:e,params:t},a)})})},e.prototype.listen=function(e,t,n){var r=this;void 0===t&&(t={}),this.logger("[listen: "+e+"] params: "+t);var i=function(i){i="string"==typeof i?JSON.parse(i):i,r.logger("[listen: "+e+"] ("+JSON.stringify(t)+") => "+JSON.stringify(i)),i.success&&"function"==typeof n&&n(i.data)};this.bridge?this.bridge.callHandler(this.token,{handlerName:e,params:t||{}},i):this.bridgeWrapper.then(function(){r.bridge.callHandler(r.token,{handlerName:e,params:t||{}},i)})},e}();function o(e,t){function n(e){return e<9?"0"+e:""+e}return void 0===t&&(t=!1),function(r){for(var i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];if(t){var o=new Date,u=o.getFullYear()+"-"+n(o.getMonth()+1)+"-"+n(o.getDate())+" "+n(o.getHours())+":"+n(o.getMinutes())+":"+n(o.getSeconds()),c=i.map(function(e){return""+e}).join(" ");console.log("["+u+" "+e+"]: "+r+" "+c)}}}var u=new a(o("Guard"));function c(e,t){void 0===e&&(e=""),void 0===t&&(t="");for(var n=e.split(".").map(function(e){return+e}),r=t.split(".").map(function(e){return+e}),i=Math.max(r.length,n.length),a=0;a<i;a++){if(n[a]||0===n[a]){if(r[a]||0===r[a]){if(n[a]<r[a])return"<";if(n[a]>r[a])return">";continue}return">"}return r[a]||0===r[a]?"<":">"}return"="}var s=function(){function e(){}return e.GreaterThanOrEqualTo=function(e){return function(t,n,r){var i=r.value;"function"==typeof i&&(r.value=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new Promise(function(r,a){var o=setTimeout(function(){a(new Error("暂不支持该方法"))},1e3);u.callHandler("device.getAppVersion").then(function(r){return clearTimeout(o),"<"===c(r,e)&&a(new Error("当前版本过低")),i.apply(t,n)}).then(function(e){r(e)}).catch(function(e){a(e)})})})}},e.LessThanOrEqualTo=function(e){return function(t,n,r){var i=r.value;"function"==typeof i&&(r.value=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new Promise(function(r,a){var o=setTimeout(function(){a(new Error("暂不支持该方法"))},1e3);u.callHandler("device.getAppVersion").then(function(r){return clearTimeout(o),">"===c(r,e)&&a(new Error("当前版本过高")),i.apply(t,n)}).then(function(e){r(e)}).catch(function(e){a(e)})})})}},e}(),l=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},d=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e){this.apiRegister=new a(o("Device",e))}return e.prototype.getLocation=function(){return this.apiRegister.callHandler("device.getLocation")},e.prototype.chooseImage=function(e){return void 0===e&&(e={max:10,sourceType:["拍照","相册"]}),this.apiRegister.callHandler("device.chooseImage",e)},e.prototype.capture=function(){return this.apiRegister.callHandler("device.capture")},e.prototype.scan=function(e){return this.apiRegister.callHandler("device.scan",{type:e})},e.prototype.savePicture=function(e){return this.apiRegister.callHandler("device.savePicture",e)},e.prototype.getAppVersion=function(){return this.apiRegister.callHandler("device.getAppVersion")},l([s.GreaterThanOrEqualTo("2.8.2.0"),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",void 0)],e.prototype,"savePicture",null),e}(),f=function(){function e(e){this.apiRegister=new a(o("Util",e))}return e.prototype.share=function(e){return this.apiRegister.callHandler("util.share",e)},e.prototype.dataCollection=function(e){return this.apiRegister.callHandler("util.dataCollection",e)},e.prototype.subscribeArea=function(e){return this.apiRegister.listen("util.area.get",null,e)},e}(),g=function(){function e(e){this.util=new f(e),this.apiRegister=new a(o("Pay",e))}return e.prototype.pay=function(e){return this.apiRegister.callHandler("pay.pay",e)},e}(),h=function(){function e(e){this.apiRegister=new a(o("User",e))}return e.prototype.authorization=function(e){return this.apiRegister.callHandler("user.authorization",{clientId:e})},e.prototype.realNameValidate=function(e){return void 0===e&&(e=!1),this.apiRegister.callHandler("user.realname.related",{againCheck:e})},e}();n.d(t,"HybridBridge",function(){return v}),n.d(t,"hybridBridge",function(){return y}),n.d(t,"version",function(){return m}),n.d(t,"Core",function(){return a}),n.d(t,"Device",function(){return p}),n.d(t,"User",function(){return h}),n.d(t,"Util",function(){return f});var v=function(){function e(e){void 0===e&&(e=!1),this._debug=!1,this.debug=e}return Object.defineProperty(e.prototype,"apiRegister",{get:function(){return new a(o("Custom",this.debug))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,this.device=new p(e),this.pay=new g(e),this.user=new h(e),this.util=new f(e)},enumerable:!0,configurable:!0}),e}(),y=new v,m="0.0.1-alpha.5"},function(e,t){!function(){var e=navigator.userAgent;if(!(e.indexOf("AlipayClient")>-1)){e.indexOf("Android")>-1||e.indexOf("Adr");if(!!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&!window.WebViewJavascriptBridge){var t,n=[],r=[],i={},a="ybb",o="__QUEUE_MESSAGE__/",u={},c=1,s=window.WebViewJavascriptBridge={init:function(e){if(s._messageHandler)throw new Error("WebViewJavascriptBridge.init called twice");s._messageHandler=e;var t=r;r=null;for(var n=0;n<t.length;n++)f(t[n])},send:function(e,t){p({data:e},t)},registerHandler:function(e,t){i[e]=t},callHandler:function(e,t,n){p({handlerName:e,data:t},n)},_fetchQueue:function(){var e=JSON.stringify(n);n=[],t.src=a+"://return/_fetchQueue/"+encodeURIComponent(e)},_handleMessageFromNative:function(e){console.log(e),r&&r.length>0?r.push(e):f(e)}},l=document;!function(e){(t=e.createElement("iframe")).style.display="none",e.documentElement.appendChild(t)}(l);var d=l.createEvent("Events");d.initEvent("WebViewJavascriptBridgeReady"),d.bridge=s,l.dispatchEvent(d)}}function p(e,r){if(r){var i="cb_"+c+++"_"+(new Date).getTime();u[i]=r,e.callbackId=i}n.push(e),t.src=a+"://"+o}function f(e){setTimeout(function(){var t,n=JSON.parse(e);if(n.responseId){if(!(t=u[n.responseId]))return;t(n.responseData)}else{if(n.callbackId){var r=n.callbackId;t=function(e){p({responseId:r,responseData:e})}}var a=s._messageHandler;n.handlerName&&(a=i[n.handlerName]);try{a(n.data,t)}catch(e){"undefined"!=typeof console&&console.log("WebViewJavascriptBridge: WARNING: javascript handler threw.",n,e)}}})}}()}])});
  </script>
  <script src="https://nnapp.cloudbae.cn:38080/storage/api/v1/file/hybrid/hybrid-api-3.5.3.js" type="text/javascript"></script>
</head>
<body>
<textarea type="text" id="imageContact" style="width:100%; height:200px;"></textarea>
<br>
<button type="button" id="btn">保存图片</button>
<br>
<button type="button" id="getHealthData">获取健康数据</button>
<script>
  var btn = document.getElementById('btn');
  var data = document.getElementById('imageContact')
  var encode = data.value.indexOf('http') == 0 ? 'url' : 'base64'
  btn.onclick = function () {
    LocalYBB.hybridBridge.device.savePicture({
      data: data.value,
      encode: encode
    }).then(function () {
      var msg = "保存成功"
      console.log(msg)
      alert(msg)
    }).catch(function (e) {
      console.log(e.message)
      alert(e.message)
    })
  }

  var btnGetHealthData = document.getElementById('getHealthData');
  btnGetHealthData.onclick = function () {
    // alert('1234')
    YBB.hybrid.user.healthData({
      type: 'stepCount',
      startDate: '2019-01-24', // 时间支持两种格式： yyy-MM-dd 或者 yyyy-MM-dd hh:mm:ss
      endDate: '2019-01-20'
    }).then(function(result) {
      console.log(result.stepCount)
      alert(result)
    }).catch(function (e) {
      console.log(e.message)
      alert(e)
    })
  }
  
</script>
</body>
</html>
